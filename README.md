# autoLoadCasperJS автоматический загрузчик тарифов.

autoLoadCasperJS написан с использованием CasperJS на языке JavaScript.

CasperJS обёртка для headless браузера PhantomJS.

Основной файл в репозитории, casper.js.<br>
Файлы конфигураций **config_*.js**.

### Обязательные компоненты:
1. NODEJS;
2. PhantomJS;
3. CasperJS.

### Подключаемые модули:
1. Urlparse;
2. Config;
3. FS.

Настройка выполнения процедур(ы) загрузки, настраивается в конфигурационном файле **config_local.js** и **config_prod.js**.

### Запуск
Для запуска в `local` окружении выполните команду: `casperjs --ignore-ssl-errors=true casper.js`<br>
Для запуска в `production` окружении выполните команду: `casperjs --ignore-ssl-errors=true casper.js --prod`

HTML лог пишется в папку `logs`.<br>
Скриншоты, пишутся в папку `pic`.

### Описание конфигурационного файла:
 - <b>credentials</b>. Обьект логин и пароль для входа в CMS.
 - <b>tarrifs</b>. Массив обьектов описаний тарифов.
    - <b>name</b> - Название тарифа.
    - <b>educationDict</b>. Словарь, которому надо обучить тариф.
 - <b>mainUrl</b>. http(s) адрес CMS.
 - <b>versions</b>. Строковый массив версий, для которых необходимо применить ревизию.
 - <b>htmlLog</b>. (true|false). Отвечает за писать ли html лог файл или выводить просто в консоль.<br>
 - <b>sendMail</b>. (true|false). Отвечает за доставку уведомлений на почту.
 - <b>toMailSends</b>. На какие адреса отсылать отчёт о проделанной работе.
 - <b>revisionId</b>. (int) Устанавливает номер ревизии по-умолчанию. См. [Установка "revisionId"](#revisionSet)
 - <b>steps</b>. Массив этапов которые необходимо проделать.<br>
	Т.е. можно выполнить этапы выборочно.<br>
	Так же допустим символ "__*__", который выполняет все этапы.<br>
	"__*__" имеет более высший приоритет.

### Описание этапов:
__*__ - Выполнить все этапы<br>
1 - Авторизация<br>
2 - Создание пустой ревизии<br>
3 - 8 часовой импорт<br>
4 - Обучение<br>
5 - Фиксация ревизии<br>
6 - Выбор для какой версии применить новую ревизию и ожидание завершения экспорта<br>
7 - Обновление состояния ревизии для версий приложения<br>

### <a name="revisionSet"></a>Установка "revisionId"
Когда загрузку необходимо с первого этапа, номер ревизии необходимо оставить равное 0.<br>
Когда необходимо запускать обработку с 3 и более этапов, необходимо выставить номер ревизии (int)
